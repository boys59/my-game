System.register("chunks:///_virtual/BattleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleService.ts"],(function(e){var t,n,r,a,i,l,o,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,o=e.Label,c=e.Component},function(e){u=e.BattleService}],execute:function(){var s,p,y,b,w,f,m,h,L,P;i._RF.push({},"dc87dFI0ytJPaVn5H4pmnSo","BattleController",void 0);var g=l.ccclass,v=l.property;e("BattleController",(s=g("BattleController"),p=v(o),y=v(o),b=v(o),s(((P=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,r(t,"winRateLabel",m,a(t)),r(t,"playerPowerLabel",h,a(t)),r(t,"enemyPowerLabel",L,a(t)),t.battleService=new u,t}n(t,e);var i=t.prototype;return i.start=function(){t.instance=this},t.getInstance=function(){return t.instance},i.setEnemyInfo=function(e,t){var n=this.battleService.calculateBattle({enemyName:e,enemyRarity:t});this.winRateLabel&&(this.winRateLabel.string="èƒœç‡: "+n.winRate),this.playerPowerLabel&&(this.playerPowerLabel.string="ç©å®¶æˆ˜åŠ›: "+n.playerPower),this.enemyPowerLabel&&(this.enemyPowerLabel.string="æ•Œäººæˆ˜åŠ›: "+n.enemyPower),console.log("æ•Œäººä¿¡æ¯: "+e+", ç¨€æœ‰åº¦: "+t+", æˆ˜åŠ›: "+n.enemyPower+", èƒœç‡: "+n.winRate)},i.update=function(e){},t}(c)).instance=null,m=t((f=P).prototype,"winRateLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=t(f.prototype,"playerPowerLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(f.prototype,"enemyPowerLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=f))||w));i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleService.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"ba3ceIaXzJPZ4L/LVWeE7zk","BattleService",void 0);e("BattleService",function(){function e(){this.playerPower=500,this.k=3.5}var t=e.prototype;return t.setPlayerPower=function(e){this.playerPower=e},t.setK=function(e){this.k=e},t.calculateBattle=function(e){var t=e.enemyName,r=e.enemyRarity,a=this.generateEnemyPower(r),n=this.calculateWinRate(this.playerPower,a,this.k),i=this.determineBattleResult(n);return{playerPower:this.playerPower,enemyPower:a,enemyName:t,enemyRarity:r,isVictory:i,winRate:n}},t.calculateWinRate=function(e,t,r){return(100*(.01+.98/(1+Math.exp(-r*(e/t-1))))).toFixed(2)+"%"},t.generateEnemyPower=function(e){var t,r;switch(e){case"N":t=.75,r=1;break;case"R":t=1,r=1.2;break;case"SR":t=1.2,r=1.5;break;case"SSR":t=1.5,r=2;break;default:t=.75,r=1}var a=t+Math.random()*(r-t);return Math.floor(500*a)},t.determineBattleResult=function(e){var t=parseFloat(e)/100;return Math.random()<t},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,n,l,a,i,r,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){a=t.cclegacy,i=t._decorator,r=t.Node,c=t.Component}],execute:function(){var s,u,d,p,h,B;a._RF.push({},"a317aK03KpA8rPQoBdFHqLF","BattleUI",void 0);var f=i.ccclass,b=i.property;t("Battle",(s=f("Battle"),u=b(r),s(((B=function(t){function e(){for(var e,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a))||this,n(e,"battleNode",h,l(e)),e}o(e,t);var a=e.prototype;return a.start=function(){console.log("=== Battle ç»„ä»¶åˆå§‹åŒ– ==="),e.instance=this,console.log("Battle instance å·²è®¾ç½®:",e.instance),console.log("Battle Node:",this.battleNode)},a.update=function(t){},e.getInstance=function(){return e.instance},a.showBattleUI=function(){console.log("=== showBattleUI è¢«è°ƒç”¨ ==="),this.battleNode?(this.battleNode.active=!0,console.log("Battle UI å·²è®¾ç½®ä¸ºæ˜¾ç¤º")):console.error("âŒ æ— æ³•æ˜¾ç¤º Battle UI - battleNode ä¸ºç©º")},a.hideBattleUI=function(){console.log("=== hideBattleUI è¢«è°ƒç”¨ ==="),this.battleNode?(this.battleNode.active=!1,console.log("Battle UI å·²è®¾ç½®ä¸ºéšè—")):console.error("âŒ æ— æ³•éšè— Battle UI - battleNode ä¸ºç©º")},e}(c)).instance=null,h=e((p=B).prototype,"battleNode",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=p))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/ConfigManager.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"cb2c2OdXglE6q1TdulLK0aU","ConfigManager",void 0),n("ConfigManager",function(){function n(){this.currentConfigIndex=0,this.configs=[{name:"å¹³æ»‘æå‡å‹",location:"ã€è¥¿é©¬æ‘æ‘å£ã€‘",battleTriggerRate:50,rarityProbabilities:{N:60,R:30,SR:9,SSR:1}},{name:"å¥‡é‡çˆ†å‘å‹",location:"ã€è¥¿é©¬æ‘éƒŠå¤–ã€‘",battleTriggerRate:20,rarityProbabilities:{N:30,R:45,SR:20,SSR:5}}]}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var t=n.prototype;return t.getCurrentConfig=function(){return this.configs[this.currentConfigIndex]},t.switchConfig=function(n){n>=0&&n<this.configs.length&&(this.currentConfigIndex=n)},t.getConfigCount=function(){return this.configs.length},t.getConfig=function(n){return n>=0&&n<this.configs.length?this.configs[n]:this.configs[0]},t.checkBattleTrigger=function(){var n=this.getCurrentConfig();return 100*Math.random()<n.battleTriggerRate},n}()).instance=null,t._RF.pop()}}}));

System.register("chunks:///_virtual/Data%20cener.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,l,a,r,i,o,s,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,l=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){r=e.cclegacy,i=e._decorator,o=e.Label,s=e.Button,c=e.Component}],execute:function(){var g,u,b,p,h,f,L,v,y,d,m,M,w,E,S,C,I,x,z;r._RF.push({},"8795fTn4IBE1r8GUpixfQjm","Data%20cener",void 0);var B=i.ccclass,P=i.property;e("Data",(g=B("Data"),u=P(o),b=P(o),p=P(o),h=P(o),f=P(s),L=P(o),v=P(o),y=P(o),g((M=t((m=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t=e.call.apply(e,[this].concat(r))||this,l(t,"xpLabel",M,a(t)),l(t,"cpLabel",w,a(t)),l(t,"mLabel",E,a(t)),l(t,"ageLabel",S,a(t)),l(t,"ageButton",C,a(t)),l(t,"levelLabel",I,a(t)),l(t,"recordLabel",x,a(t)),l(t,"yearLabel",z,a(t)),t.levelManager=null,t}n(t,e);var r=t.prototype;return r.start=function(){this.initLabels(),this.initLevelManager(),this.ageButton&&this.ageButton.node.on("click",this.onAgeButtonClick,this)},r.initLevelManager=function(){var e=this.node.getChildByName("LevelManager");this.levelManager=e?e.getComponent("LevelManager"):this.node.getComponent("LevelManager"),this.levelManager?console.log("LevelManageråˆå§‹åŒ–æˆåŠŸ"):console.warn("LevelManagerç»„ä»¶æœªæ‰¾åˆ°ï¼Œç­‰çº§ç³»ç»Ÿå°†ä½¿ç”¨ç®€åŒ–æ¨¡å¼")},r.update=function(e){},r.initLabels=function(){this.xpLabel&&(this.xpLabel.string="0%"),this.cpLabel&&(this.cpLabel.string="120"),this.mLabel&&(this.mLabel.string="120"),this.ageLabel&&(this.ageLabel.string="120"),this.yearLabel&&(this.yearLabel.string="ç¬¬1å¹´")},r.handleEvent=function(e){console.log("=== handleEvent å¼€å§‹ ==="),console.log("åŸå§‹æ•°æ®:",e),console.log("åŸå§‹æ•°æ®ç±»å‹:",typeof e);var t=null;if(e&&"object"==typeof e)if(e.event)t=e.event;else if(e.detail){var n=e.detail;if("string"==typeof n)try{n=JSON.parse(n),console.log("æˆåŠŸå°†detailå­—ç¬¦ä¸²è§£æä¸ºJSONå¯¹è±¡:",n)}catch(e){console.error("è§£ædetailå­—ç¬¦ä¸²å¤±è´¥:",e)}t=n.event||n}else t=e;else if("string"==typeof e)try{var l=JSON.parse(e);t=l.event||l}catch(e){return void console.error("JSONè§£æå¤±è´¥:",e)}t||(t=e),console.log("æœ€ç»ˆè§£æçš„eventå¯¹è±¡:",t),console.log("eventå¯¹è±¡çš„æ‰€æœ‰å­—æ®µ:","object"==typeof t?Object.keys(t):"N/A"),console.log("å®Œæ•´eventå†…å®¹:",JSON.stringify(t,null,2));var a=null,r=null,i=null,o=null;if(t&&"object"==typeof t&&(a=t.type,r=t.value,i=t.record,o=t.year),console.log("æå–çš„å­—æ®µ - type:",a,"value:",r,"record:",i,"year:",o),console.log("recordç±»å‹:",typeof i,"recordé•¿åº¦:",i?i.length:"null/undefined"),console.log("yearç±»å‹:",typeof o,"yearå€¼:",o),this.yearLabel&&null!=o&&(this.yearLabel.string="ç¬¬"+o+"å¹´"),this.recordLabel)if(console.log("recordLabelå­˜åœ¨ï¼Œå‡†å¤‡å†™å…¥"),null!=i&&""!==i&&"string"==typeof i){var s=""+(o?"ç¬¬"+o+"å¹´ ":"")+i,c=this.recordLabel.string||"",g=c+(c?"\n":"")+s;this.recordLabel.string=g,console.log("âœ… æˆåŠŸå†™å…¥recordå†…å®¹ (è¿½åŠ æ¨¡å¼):",s),console.log("ğŸ“ å½“å‰æ€»å†…å®¹é•¿åº¦:",g.length)}else console.log("âš ï¸ recordå€¼ä¸ºç©ºæˆ–undefinedæˆ–ç±»å‹é”™è¯¯ï¼Œæœªå†™å…¥:",i,"ç±»å‹:",typeof i);else console.log("âš ï¸ recordLabelä¸å­˜åœ¨");switch(a||"XP"){case"XP":this.handleXP("string"==typeof r?parseInt(r)||0:r);break;case"CP":this.handleCP("string"==typeof r?parseInt(r)||0:r);break;case"M":this.handleM("string"==typeof r?parseInt(r)||0:r);break;case"AGE":this.handleAGE("string"==typeof r?parseInt(r)||0:r);break;case"AGE_DECREASE":this.ageLabel&&(this.ageLabel.string=(parseInt(this.ageLabel.string)-1).toString())}console.log("=== handleEvent ç»“æŸ ===")},r.handleXP=function(e){if(this.xpLabel)if(this.levelManager){var t=this.levelManager.addExperience(e);this.xpLabel.string=t+"%",console.log("ç­‰çº§ç³»ç»Ÿå·²è¿ç§»åˆ°LevelManagerï¼Œå½“å‰ç»éªŒ: "+this.levelManager.getCurrentXP()+", è¿›åº¦: "+t+"%")}else console.warn("LevelManageræœªæ‰¾åˆ°ï¼Œä½¿ç”¨ç®€åŒ–ç»éªŒå¤„ç†"),this.xpLabel.string=Math.min(100,e)+"%"},r.handleCP=function(e){if(this.cpLabel){var t=parseInt(this.cpLabel.string)||0;this.cpLabel.string=(t+e).toString()}},r.handleM=function(e){if(this.mLabel){var t=parseInt(this.mLabel.string)||0;this.mLabel.string=(t+e).toString()}},r.handleAGE=function(e){if(this.ageLabel){var t=parseInt(this.ageLabel.string)||0;this.ageLabel.string=(t+e).toString()}},r.onAgeButtonClick=function(){this.ageLabel&&(this.ageLabel.string=(parseInt(this.ageLabel.string)-1).toString())},t}(c)).prototype,"xpLabel",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(m.prototype,"cpLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(m.prototype,"mLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(m.prototype,"ageLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(m.prototype,"ageButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(m.prototype,"levelLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(m.prototype,"recordLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(m.prototype,"yearLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=m))||d));r._RF.pop()}}}));

System.register("chunks:///_virtual/Display.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,r,i,o,c,a,s;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){o=t.cclegacy,c=t._decorator,a=t.Label,s=t.Component}],execute:function(){var l,u,p,h,f;o._RF.push({},"4658e5jFYZHUrNtg9K9n6B1","Display",void 0);var y=c.ccclass,b=c.property;t("Display",(l=y("Display"),u=b(a),l((f=n((h=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),c=0;c<e;c++)o[c]=arguments[c];return n=t.call.apply(t,[this].concat(o))||this,r(n,"contentLabel",f,i(n)),n.currentContent="",n}e(n,t);var o=n.prototype;return o.setContent=function(t){void 0===t&&(t=""),this.currentContent=t,this.contentLabel&&(this.contentLabel.string=t)},o.appendContent=function(t){this.currentContent+=t,this.contentLabel&&(this.contentLabel.string=this.currentContent)},o.getContent=function(){return this.currentContent},n}(s)).prototype,"contentLabel",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=h))||p));o._RF.pop()}}}));

System.register("chunks:///_virtual/DunageonData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,i,o,a,l,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.Label,s=e.Component}],execute:function(){var c,u,p,b,f,g,h,L,d;o._RF.push({},"501195BwItCd4bliMY2t97U","DunageonData",void 0);var y=a.ccclass,D=a.property;e("Dunageon",(c=y("Dunageon"),u=D(l),p=D(l),b=D(l),c((h=t((g=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"progressLabel",h,i(t)),n(t,"interface2Label",L,i(t)),n(t,"locationLabel",d,i(t)),t.progress=0,t}r(t,e);var o=t.prototype;return o.start=function(){},o.update=function(e){},o.addProgress=function(){var e=Math.random();this.progress+=e<.5?4:5,this.progressLabel&&(this.progressLabel.string=this.progress+"%")},o.interface2Method=function(){},o.updateLocation=function(e){this.locationLabel&&(this.locationLabel.string=e)},t}(s)).prototype,"progressLabel",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(g.prototype,"interface2Label",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(g.prototype,"locationLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));o._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonAPI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LLMAPI.ts","./PromptManager.ts","./BattleService.ts","./ResponseParser.ts","./ConfigManager.ts"],(function(e){var t,n,r,i,a,o,s,u;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){r=e.cclegacy},function(e){i=e.LLMAPI},function(e){a=e.PromptManager},function(e){o=e.BattleService},function(e){s=e.ResponseParser},function(e){u=e.ConfigManager}],execute:function(){r._RF.push({},"45428q73ddAR583EPhzZKS5","DungeonAPI",void 0),e("DungeonAPI",function(){function e(){this.llmAPI=null,this.battleService=new o,this.llmAPI=i.getInstance(),this.llmAPI.setHistoryType("dungeon")}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var r=e.prototype;return r.generateRandomWeights=function(){var e,t=u.getInstance().getCurrentConfig(),n=100*Math.random();e=n<t.rarityProbabilities.N?"N":n<t.rarityProbabilities.N+t.rarityProbabilities.R?"R":n<t.rarityProbabilities.N+t.rarityProbabilities.R+t.rarityProbabilities.SR?"SR":"SSR";var r,i=100*Math.random();r=i<10?"Consumable":i<20?"Treasure":i<30?"Material":"None";var a=100*Math.random();return{rarity_type:e,item_type:r,attribute_type:a<33.3?"CP":a<66.6?"XP":"M",is_battle:u.getInstance().checkBattleTrigger()}},r.requestEvent=function(){var e=t(n().mark((function e(t,r,i){var o,u,c,l,g=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"battle"===t?(c=this.battleService.calculateBattle({enemyName:r.enemyName,enemyRarity:r.enemyRarity}),o=a.getInstance().getBattlePrompt(c),u=void 0):(l=this.generateRandomWeights(),u=a.getInstance().getDungeonSystemPrompt(),o=a.getInstance().getDungeonUserPrompt({userChoice:r.userChoice,rarity:l.rarity_type,item:l.item_type,attribute:l.attribute_type,battle:l.is_battle})),this.llmAPI.setHistoryType("dungeon"),e.abrupt("return",new Promise((function(e,t){g.llmAPI.streamRequest(o,u,i,(function(n){try{console.log("=== AI å“åº”è°ƒè¯•ä¿¡æ¯ ==="),console.log("åŸå§‹å“åº”å†…å®¹:",n);var r=s.parseLLMResponse(n);e(r)}catch(e){console.error("è§£æAIå“åº”å¤±è´¥:",e),t(new Error("è§£æAIå“åº”å¤±è´¥: "+(e instanceof Error?e.message:String(e))))}}),(function(e){console.error("LLMè¯·æ±‚å¤±è´¥:",e),t(e)}))})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),r.requestDungeonEvent=function(e,t){return this.requestEvent("explore",{userChoice:e},t)},r.requestBattleEvent=function(e,t,n){return this.requestEvent("battle",{enemyName:e,enemyRarity:t},n)},e}()).instance=null,r._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Display.ts","./DungeonAPI.ts","./DunageonData.ts","./BattleUI.ts","./BattleService.ts","./BattleController.ts"],(function(t){var n,e,o,i,r,a,l,s,u,c,h,g,b,p,f,d,y,B,m,v;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){l=t.cclegacy,s=t._decorator,u=t.Node,c=t.ScrollView,h=t.Button,g=t.Label,b=t.instantiate,p=t.Component},function(t){f=t.Display},function(t){d=t.DungeonAPI},function(t){y=t.Dunageon},function(t){B=t.Battle},function(t){m=t.BattleService},function(t){v=t.BattleController}],execute:function(){var I,D,C,w,P,E,k,L,A,R,T,z,S,_,M,N,U,V,O;l._RF.push({},"ec8daZukvVMx73EwPwByRtv","DungeonManager",void 0);var x=s.ccclass,K=s.property;t("DungeonManager",(I=x("DungeonManager"),D=K(u),C=K(u),w=K(c),P=K(h),E=K(h),k=K(h),L=K(h),A=K(y),I((z=n((T=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return n=t.call.apply(t,[this].concat(r))||this,o(n,"dungeonPrefab",z,i(n)),o(n,"contentContainer",S,i(n)),o(n,"scrollView",_,i(n)),o(n,"button1",M,i(n)),o(n,"button2",N,i(n)),o(n,"button3",U,i(n)),o(n,"startBattleButton",V,i(n)),o(n,"dungeonData",O,i(n)),n.dungeonAPI=null,n.currentDungeonDisplay=null,n.isLoading=!1,n.battleService=new m,n.enemyName="",n.enemyRarity="",n.battleParams=null,n}e(n,t);var l=n.prototype;return l.start=function(){if(console.log("=== DungeonManager åˆå§‹åŒ– ==="),this.dungeonAPI=d.getInstance(),!this.startBattleButton){var t=this.node.getChildByPath("èƒŒæ™¯/é€‰é¡¹åŒº/Battle/Battle UI/start pk");t?(this.startBattleButton=t.getComponent(h),console.log("âœ… é€šè¿‡è·¯å¾„æ‰¾åˆ° start pk æŒ‰é’®")):console.error("âŒ æ— æ³•æ‰¾åˆ° start pk æŒ‰é’®")}this.bindButtonEvents(),console.log("=== DungeonManager åˆå§‹åŒ–å®Œæˆ ===")},l.bindButtonEvents=function(){var t=this;this.button1&&(this.button1.node.on(h.EventType.CLICK,(function(){return t.onButtonClicked("1")}),this),console.log("âœ… æŒ‰é’®1ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š")),this.button2&&(this.button2.node.on(h.EventType.CLICK,(function(){return t.onButtonClicked("2")}),this),console.log("âœ… æŒ‰é’®2ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š")),this.button3&&(this.button3.node.on(h.EventType.CLICK,(function(){return t.onButtonClicked("3")}),this),console.log("âœ… æŒ‰é’®3ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š")),this.startBattleButton&&(this.startBattleButton.node.on(h.EventType.CLICK,(function(){return t.onBattleButtonClick()}),this),console.log("âœ… å¼€å§‹æˆ˜æ–—æŒ‰é’®ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š"))},l.onButtonClicked=function(t){var n,e=this;if(!this.isLoading){null==(n=this.dungeonData)||n.addProgress(),this.isLoading=!0,this.setButtonsInteractable(!1),this.currentDungeonDisplay=this.createDungeonDisplay();var o="",i=null;if("1"===t&&this.button1?i=this.button1:"2"===t&&this.button2?i=this.button2:"3"===t&&this.button3&&(i=this.button3),i){var r=i.node.getComponentInChildren(g);r&&(o=r.string)}o&&this.currentDungeonDisplay&&this.currentDungeonDisplay.appendContent("\n> "+o+"\n"),this.dungeonAPI.requestDungeonEvent(t,(function(t){var n;null==(n=e.currentDungeonDisplay)||n.appendContent(t),e.autoScrollToBottom()})).then((function(t){e.isLoading=!1,e.setButtonsInteractable(!0),e.updateButtonOptions(t)})).catch((function(t){console.error("è¯·æ±‚å¤±è´¥:",t),e.isLoading=!1,e.setButtonsInteractable(!0)}))}},l.createDungeonDisplay=function(){var t=this;if(!this.contentContainer||!this.dungeonPrefab)return null;var n=b(this.dungeonPrefab);return n.name="Dungeon_"+Date.now(),this.contentContainer.addChild(n),this.scheduleOnce((function(){t.autoScrollToBottom()}),.1),n.getComponent(f)},l.updateButtonOptions=function(t){var n;if(console.log("=== updateButtonOptions è¢«è°ƒç”¨ ==="),console.log("AI å“åº”:",t),t&&Array.isArray(t)&&0!==t.length){var e,o=t[0];if(console.log("äº‹ä»¶æ•°æ®:",o),o.meta&&o.meta.location)null==(e=this.dungeonData)||e.updateLocation(o.meta.location);var i=null==(n=o.interaction)?void 0:n.is_battle;if(console.log("is_battle å€¼:",i),void 0!==i)if(i){var r,a,l;console.log("è°ƒç”¨ Battle.getInstance().showBattleUI()"),null==(r=B.getInstance())||r.showBattleUI();var s=null==(a=o.interaction)||null==(a=a.type)?void 0:a.Enemy,u=null==(l=o.interaction)||null==(l=l.type)?void 0:l.rarity_type;s&&u?(console.log("è®¾ç½®æ•Œäººä¿¡æ¯: "+s+", ç¨€æœ‰åº¦: "+u),this.setEnemyInfo(s,u)):console.error("âŒ æ— æ³•è·å–æ•Œäººä¿¡æ¯")}else{var c;console.log("è°ƒç”¨ Battle.getInstance().hideBattleUI()"),null==(c=B.getInstance())||c.hideBattleUI()}else console.log("âš ï¸ AI å“åº”ä¸­æ²¡æœ‰ is_battle å­—æ®µ");if(o.interaction&&o.interaction.options){var h=o.interaction.options;if(this.button1&&h[1]){var b=this.button1.node.getComponentInChildren(g);b&&(b.string=h[1])}if(this.button2&&h[2]){var p=this.button2.node.getComponentInChildren(g);p&&(p.string=h[2])}if(this.button3&&h[3]){var f=this.button3.node.getComponentInChildren(g);f&&(f.string=h[3])}console.log("âœ… æŒ‰é’®é€‰é¡¹å·²æ›´æ–°")}}else console.error("âŒ AIå“åº”æ ¼å¼é”™è¯¯ï¼Œæ— æ³•æ›´æ–°æŒ‰é’®")},l.setEnemyInfo=function(t,n){this.enemyName=t,this.enemyRarity=n,this.battleParams=this.battleService.calculateBattle({enemyName:t,enemyRarity:n});var e=v.getInstance();e&&e.setEnemyInfo(t,n),console.log("æ•Œäººä¿¡æ¯: "+t+", ç¨€æœ‰åº¦: "+n+", æˆ˜åŠ›: "+this.battleParams.enemyPower+", èƒœç‡: "+this.battleParams.winRate)},l.startBattle=function(){var t=r(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enemyName&&this.enemyRarity){t.next=3;break}return console.error("æ•Œäººä¿¡æ¯æœªè®¾ç½®"),t.abrupt("return",Promise.reject(new Error("æ•Œäººä¿¡æ¯æœªè®¾ç½®")));case 3:return console.log("æˆ˜æ–—åˆ¤å®š: "+(this.battleParams.isVictory?"èƒœåˆ©":"å¤±è´¥")+", èƒœç‡: "+this.battleParams.winRate),t.abrupt("return",this.dungeonAPI.requestBattleEvent(this.enemyName,this.enemyRarity,n));case 5:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),l.setButtonsInteractable=function(t){this.button1&&(this.button1.interactable=t),this.button2&&(this.button2.interactable=t),this.button3&&(this.button3.interactable=t)},l.autoScrollToBottom=function(){this.scrollView&&this.scrollView.scrollToBottom(.1)},l.onBattleButtonClick=function(){var t,n=this;if(this.enemyName&&this.enemyRarity){null==(t=B.getInstance())||t.hideBattleUI(),this.setButtonsInteractable(!1);var e=this.createDungeonDisplay();this.startBattle((function(t){null==e||e.appendContent(t),n.autoScrollToBottom()})).then((function(t){n.setButtonsInteractable(!0),t&&t.length>0&&n.updateButtonOptions(t)})).catch((function(t){console.error("æˆ˜æ–—è¯·æ±‚å¤±è´¥:",t),n.setButtonsInteractable(!0)}))}else console.error("æ•Œäººä¿¡æ¯æœªè®¾ç½®ï¼Œè¯·å…ˆè°ƒç”¨setEnemyInfo")},n}(p)).prototype,"dungeonPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(T.prototype,"contentContainer",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(T.prototype,"scrollView",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(T.prototype,"button1",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(T.prototype,"button2",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(T.prototype,"button3",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(T.prototype,"startBattleButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(T.prototype,"dungeonData",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=T))||R));l._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonSummarize.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var e,t,r,u;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,r=n._decorator,u=n.Component}],execute:function(){var o;t._RF.push({},"0bed6MCu5NFfZwh48Cu8XLq","DungeonSummarize",void 0);var c=r.ccclass;r.property,n("lnstascanceSummarize",c("lnstascanceSummarize")(o=function(n){function t(){return n.apply(this,arguments)||this}e(t,n);var r=t.prototype;return r.start=function(){},r.update=function(n){},t}(u))||o);t._RF.pop()}}}));

System.register("chunks:///_virtual/level%20Management.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,l,n,r,a,o,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,l=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,o=e.Label,s=e.Component}],execute:function(){var u,v,c,h,L;r._RF.push({},"487deqE7jBBtbTSQ9m+MqbY","level%20Management",void 0);var p=a.ccclass,f=a.property;e("LevelManager",(u=p("LevelManager"),v=f(o),u((L=t((h=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,l(t,"levelLabel",L,n(t)),t.level=0,t.totalXP=0,t.cultivationLevels=["ç»ƒæ°”","ç­‘åŸº","é‡‘ä¸¹","å…ƒå©´","åŒ–ç¥","ç‚¼è™š","åˆä½“","å¤§ä¹˜","æ¸¡åŠ«","çœŸä»™"],t}i(t,e);var r=t.prototype;return r.start=function(){this.initializeLevel()},r.initializeLevel=function(){this.levelLabel&&(this.levelLabel.string=this.getCultivationLevelDescription(this.level))},r.getXPRequiredForLevel=function(e){return Math.floor(200*Math.pow(1.045,e-1))},r.getCultivationLevelDescription=function(e){if(e<=0)return"æœªå…¥é—¨";var t=Math.floor((e-1)/10);if(t>=this.cultivationLevels.length)return"çœŸä»™å·…å³°";var i=(e-1)%10+1,l=this.cultivationLevels[t];if(10===i)return l+"å·…å³°";return""+l+["","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹"][i]+"é˜¶"},r.getXPToNextLevel=function(){var e=this.level+1;return this.getXPRequiredForLevel(e)},r.addExperience=function(e){for(this.totalXP+=e;this.totalXP>=this.getXPToNextLevel();)this.totalXP-=this.getXPToNextLevel(),this.level+=1;this.updateLevelDisplay();var t=this.getXPToNextLevel();return t>0?Math.round(this.totalXP/t*100):0},r.updateLevelDisplay=function(){this.levelLabel&&(this.levelLabel.string=this.getCultivationLevelDescription(this.level))},r.getCurrentLevel=function(){return this.level},r.getCurrentXP=function(){return this.totalXP},r.getXPToNext=function(){return this.getXPToNextLevel()},r.setLevel=function(e,t){void 0===t&&(t=0),this.level=Math.max(0,e),this.totalXP=Math.max(0,t),this.updateLevelDisplay()},t}(s)).prototype,"levelLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=h))||c));r._RF.pop()}}}));

System.register("chunks:///_virtual/LLMAPI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,r,s;return{setters:[function(e){t=e.asyncToGenerator,o=e.regeneratorRuntime,r=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy}],execute:function(){s._RF.push({},"cce98RHtydP1IKiCjjfk72y","LLMAPI",void 0),e("LLMAPI",function(){function e(){this.apiKey="sk-665d4682b25640c8939dc1d724b10eb7",this.baseURL="https://api.deepseek.com/chat/completions",this.chatHistory=[],this.yearChatHistory=[],this.dungeonChatHistory=[],this.currentHistoryType="year"}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var s=e.prototype;return s.setConfig=function(e,t){e&&(this.apiKey=e),t&&(this.baseURL=t)},s.setHistoryType=function(e){this.currentHistoryType=e,console.log("[LLMAPI] Switched history type to: "+e)},s.getCurrentHistory=function(){return"year"===this.currentHistoryType?this.yearChatHistory:this.dungeonChatHistory},s.getChatHistory=function(){return[].concat(this.getCurrentHistory())},s.clearChatHistory=function(){"year"===this.currentHistoryType?this.yearChatHistory=[]:this.dungeonChatHistory=[]},s.setSystemPrompt=function(e){var t=this.getCurrentHistory();t=t.filter((function(e){return"system"!==e.role})),e&&t.unshift({role:"system",content:e}),"year"===this.currentHistoryType?this.yearChatHistory=t:this.dungeonChatHistory=t},s.addUserMessage=function(e){this.getCurrentHistory().push({role:"user",content:e})},s.addAssistantMessage=function(e){this.getCurrentHistory().push({role:"assistant",content:e})},s.sendRequest=function(){var e=t(o().mark((function e(t){var s,n,i,a,c,l,u,g,h,y,p,f,d=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),s=this.getCurrentHistory(),i=(n=t).model,a=void 0===i?"deepseek-chat":i,c=n.temperature,l=void 0===c?.7:c,u=n.maxTokens,g=n.systemPrompt,h=n.messages,y=n.onProgress,p=n.onComplete,f=n.onError,e.abrupt("return",new Promise((function(e,t){try{var o;h?o=h:(o=[].concat(s),g&&(o=o.filter((function(e){return"system"!==e.role}))).unshift({role:"system",content:g})),console.log("=== LLM API è°ƒè¯•ä¿¡æ¯ ==="),console.log("API BaseURL:",d.baseURL),console.log("API Key (å‰10ä½):",d.apiKey.substring(0,10)+"..."),console.log("Model:",a),console.log("Temperature:",l),console.log("Messages count:",o.length),console.log("System Prompt:",g?"å·²è®¾ç½®":"æœªè®¾ç½®"),console.log("Max Tokens:",u||"æœªè®¾ç½®");var n=new XMLHttpRequest,i=0,c="",m={role:"assistant",content:""},H=!1;n.open("POST",d.baseURL,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Authorization","Bearer "+d.apiKey),n.onprogress=function(){var e=n.responseText.substring(i);i=n.responseText.length,console.log("æ”¶åˆ°æ–°æ•°æ®ï¼Œé•¿åº¦:",e.length),console.log("å½“å‰å“åº”æ–‡æœ¬ç‰‡æ®µ:",e.substring(0,200)+(e.length>200?"...":""));for(var t,o=e.split("\n"),s=r(o);!(t=s()).done;){var a=t.value;if((a=a.trim())&&"data: [DONE]"!==a){if(a.startsWith("data: "))try{var l,u=a.slice(6);console.log("è§£æJSONå­—ç¬¦ä¸²:",u.substring(0,100)+(u.length>100?"...":""));var g=null==(l=JSON.parse(u).choices[0])||null==(l=l.delta)?void 0:l.content;console.log("æå–çš„å†…å®¹:",g||"æ— å†…å®¹"),g&&(H=!0,c+=g,m.content+=g,console.log("ç´¯ç§¯å“åº”é•¿åº¦:",c.length),y&&y(g))}catch(e){console.error("è§£ææµå¼æ•°æ®å¤±è´¥:",e),console.error("é—®é¢˜è¡Œ:",a)}}else"data: [DONE]"===a&&console.log("æ”¶åˆ°ç»“æŸæ ‡è®° [DONE]")}},n.onload=function(){if(console.log("=== è¯·æ±‚å®Œæˆ ==="),console.log("HTTPçŠ¶æ€ç :",n.status),console.log("çŠ¶æ€æ–‡æœ¬:",n.statusText),console.log("å“åº”å¤´:",n.getAllResponseHeaders()),console.log("å®Œæ•´å“åº”æ–‡æœ¬:",n.responseText),console.log("æ˜¯å¦æ”¶åˆ°å†…å®¹:",H),console.log("æœ€ç»ˆç´¯ç§¯å“åº”:",c),console.log("æœ€ç»ˆå“åº”é•¿åº¦:",c.length),200===n.status)if(m.content.trim()?(s.push(m),console.log("ä¿å­˜åŠ©æ‰‹æ¶ˆæ¯åˆ°å†å²ï¼Œé•¿åº¦:",m.content.length)):console.warn("âš ï¸ åŠ©æ‰‹æ¶ˆæ¯ä¸ºç©ºï¼Œæœªä¿å­˜åˆ°å†å²"),p&&p(c),H&&""!==c.trim())console.log("âœ… è¯·æ±‚æˆåŠŸå®Œæˆ"),e(c);else{var o=new Error("AIå“åº”ä¸ºç©º - HTTP "+n.status+", ç´¯ç§¯å“åº”é•¿åº¦: "+c.length);console.error("âŒ "+o.message),t(o)}else{var r="APIè¯·æ±‚å¤±è´¥: "+n.status+" - "+n.statusText;console.error("âŒ "+r),console.error("å“åº”å†…å®¹:",n.responseText);var i=new Error(r);f&&f(i),t(i)}},n.onerror=function(){var e=new Error("ç½‘ç»œé”™è¯¯ - è¯·æ±‚æ— æ³•å‘é€");console.error("âŒ ç½‘ç»œé”™è¯¯:",e.message),f&&f(e),t(e)},n.ontimeout=function(){var e=new Error("è¯·æ±‚è¶…æ—¶");console.error("âŒ è¯·æ±‚è¶…æ—¶"),f&&f(e),t(e)};var v={model:a,messages:o.filter((function(e){return""!==e.content})),stream:!0,temperature:l};u&&(v.max_tokens=u),console.log("å‘é€è¯·æ±‚æ•°æ®:",JSON.stringify(v,null,2)),n.timeout=3e4,n.send(JSON.stringify(v))}catch(e){var T=e instanceof Error?e:new Error("æœªçŸ¥é”™è¯¯");console.error("âŒ è¯·æ±‚å¼‚å¸¸:",T.message),f&&f(T),t(T)}})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.streamRequest=function(e,t,o,r,s){return this.addUserMessage(e),this.sendRequest({systemPrompt:t,onProgress:o,onComplete:r,onError:s})},s.syncRequest=function(){var e=t(o().mark((function e(t,r,s){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.streamRequest(t,r,void 0,void 0,s));case 1:case"end":return e.stop()}}),e,this)})));return function(t,o,r){return e.apply(this,arguments)}}(),e}()).instance=null,s._RF.pop()}}}));

System.register("chunks:///_virtual/lnstance.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o,r,i,u,a,c,s,l;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){i=t.cclegacy,u=t._decorator,a=t.Button,c=t.Prefab,s=t.instantiate,l=t.Component}],execute:function(){var b,f,h,p,d,y,I,C,v,g,B,N,m;i._RF.push({},"50f1fR2rw1MOr9RhbUWwrYg","lnstance",void 0);var E=u.ccclass,w=u.property;t("lnstance",(b=E("lnstance"),f=w(a),h=w(a),p=w(a),d=w(a),y=w(c),b((v=n((C=function(t){function n(){for(var n,e=arguments.length,i=new Array(e),u=0;u<e;u++)i[u]=arguments[u];return n=t.call.apply(t,[this].concat(i))||this,o(n,"button1",v,r(n)),o(n,"button2",g,r(n)),o(n,"button3",B,r(n)),o(n,"button4",N,r(n)),o(n,"instancePrefab",m,r(n)),n.currentInstanceNode=null,n.buttons=[],n}e(n,t);var i=n.prototype;return i.start=function(){var t=this;this.buttons=[this.button1,this.button2,this.button3,this.button4],this.buttons.forEach((function(n){n&&n.node.on(a.EventType.CLICK,t.onInstanceButtonClick,t)}))},i.onInstanceButtonClick=function(){this.instancePrefab&&(this.currentInstanceNode&&this.currentInstanceNode.destroy(),this.currentInstanceNode=s(this.instancePrefab),this.node.addChild(this.currentInstanceNode),this.setupEndButton())},i.setupEndButton=function(){var t=this.currentInstanceNode.getChildByName("endbutton");if(t){var n=t.getComponent(a);n&&n.node.on(a.EventType.CLICK,this.onEndButtonClick,this)}},i.onEndButtonClick=function(){this.currentInstanceNode&&(this.currentInstanceNode.destroy(),this.currentInstanceNode=null)},i.onDestroy=function(){var t=this;this.buttons.forEach((function(n){n&&n.node.off(a.EventType.CLICK,t.onInstanceButtonClick,t)}))},n}(l)).prototype,"button1",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=n(C.prototype,"button2",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(C.prototype,"button3",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(C.prototype,"button4",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=n(C.prototype,"instancePrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=C))||I));i._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BattleController.ts","./BattleService.ts","./BattleUI.ts","./ConfigManager.ts","./DunageonData.ts","./DungeonAPI.ts","./DungeonManager.ts","./DungeonSummarize.ts","./PromptManager.ts","./ResponseParser.ts","./Summary.ts","./test.ts","./Data%20cener.ts","./Display.ts","./LLMAPI.ts","./NextButton.ts","./Prefab.ts","./Property%20Animation.ts","./Scene.ts","./YearAPI.ts","./YearManager.ts","./level%20Management.ts","./lnstance.ts","./save.ts","./window.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NextButton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,o,r,a,u,l,s,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,u=t._decorator,l=t.Button,s=t.Label,c=t.Component}],execute:function(){var b,p,h,g,f,L,y;a._RF.push({},"a7b3bhueCJGE6I9w8lm2lW0","NextButton",void 0);var d=u.ccclass,x=u.property;t("NextButton",(b=d("NextButton"),p=x(l),h=x(s),b((L=e((f=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"button",L,o(e)),i(e,"buttonLabel",y,o(e)),e.isLoading=!1,e.originalText="ä¸‹ä¸€å¹´",e}return n(e,t),e.prototype.setLoadingState=function(t){this.isLoading=t,this.button&&this.buttonLabel&&(t?(this.buttonLabel.string="åŠ è½½ä¸­...",this.button.interactable=!1):(this.buttonLabel.string=this.originalText,this.button.interactable=!0))},r(e,[{key:"isLoadingState",get:function(){return this.isLoading}}]),e}(c)).prototype,"button",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(f.prototype,"buttonLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=f))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/Prefab.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,r,i,a,u,c,l,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){i=t.cclegacy,a=t._decorator,u=t.Button,c=t.Node,l=t.instantiate,p=t.Component}],execute:function(){var s,f,h,b,y,d,m,v,x;i._RF.push({},"47f67/UFY5JrqBqIk+FDzTe","Prefab",void 0);var B=a.ccclass,C=a.property;t("NewComponent",(s=B("NewComponent"),f=C(u),h=C(c),b=C(c),s((m=e((d=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i))||this,o(e,"nextButton",m,r(e)),o(e,"content",v,r(e)),o(e,"prefabTemplate",x,r(e)),e.counter=0,e}n(e,t);var i=e.prototype;return i.start=function(){this.nextButton&&this.nextButton.node.on(u.EventType.CLICK,this.onNext,this)},i.onNext=function(){if(this.content&&this.prefabTemplate){var t=l(this.prefabTemplate);t.name="Prefab_"+ ++this.counter,this.content.addChild(t)}},i.update=function(t){},i.onDestroy=function(){this.nextButton&&this.nextButton.node.off(u.EventType.CLICK,this.onNext,this)},e}(p)).prototype,"nextButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(d.prototype,"content",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(d.prototype,"prefabTemplate",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=d))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/PromptManager.ts",["cc","./ConfigManager.ts"],(function(t){var e,n;return{setters:[function(t){e=t.cclegacy},function(t){n=t.ConfigManager}],execute:function(){e._RF.push({},"c7cb5u+c9pCNpTVsmiDmhK/","PromptManager",void 0),t("PromptManager",function(){function t(){}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance};var e=t.prototype;return e.getDungeonSystemPrompt=function(){return"Role:ä½ æ˜¯ä¿®ä»™ä¸–ç•Œçš„å¤©é“æ¼”åŒ–é€»è¾‘å¼•æ“ï¼Œè´Ÿè´£å°†å› æœå¾‹ã€åœ°ç†ç¯å¢ƒä¸éšæœºæ¦‚ç‡è½¬åŒ–ä¸ºå…·ä½“çš„ä¿®ä»™äº‹ä»¶ã€‚å½“å‰æ¼”ç®—åæ ‡ï¼š"+n.getInstance().getCurrentConfig().location+'ã€‚å½“å‰ç­‰çº§ï¼šçœŸä»™ä¹é˜¶(lv99)ã€‚Rules & Constraints:1.é€»è¾‘ä¸¥å¯†æ€§ï¼šå‰§æƒ…å¿…é¡»ä¸¥æ ¼ç¬¦åˆåœ°ç†è®¾å®šå’Œå¢ƒç•Œè®¾å®šã€‚2.æç®€è¾“å‡ºï¼šä¸¥ç¦ä»»ä½•å¼€åœºç™½ã€è§£é‡Šæˆ–æ€»ç»“ã€‚ä»…è¾“å‡ºä¸€ä¸ªç¬¦åˆ Schema çš„ JSON æ•°ç»„ã€‚3.æˆ˜æ–—åˆ¤å®šï¼šè‹¥ is_battle ä¸º trueï¼Œä»…æå†™å†²çªèµ·å› ï¼ˆå¦‚æ€æ„ã€å’†å“®ï¼‰ï¼ŒEnemy å±•ç¤ºæ•Œäººåç§°ï¼Œç¦æ­¢è‡ªè¡Œå±•å¼€æˆ˜æ–—è¿‡ç¨‹ã€‚4.ç”Ÿæˆåˆ¤å®šï¼šä»…ç”Ÿæˆä¸€æ¬¡ JSON æ•°ç»„ï¼Œoptions ä¸‹çš„æ¯ä¸ªé€‰é¡¹æœ€å¤šä¸è¶…è¿‡ 34 å­—ã€‚Output Schema (JSON Standard) [ { "meta": { "location": "å…·ä½“åœ°ç†åæ ‡Â·æ–¹ä½" }, "narrative": { "record": "èƒŒæ™¯å‰§æƒ…ï¼ˆåŒ…å«ç¯å¢ƒæ°›å›´åŠæ ¸å¿ƒå‘ç°å’Œäº§å‡ºç‰©çš„çŸ­æš‚å¤–è²Œä»‹ç»ï¼‰" }, "interaction": { "options": { "1": "é«˜é£é™©/é«˜æ”¶ç›Šè¡Œä¸º", "2": "ä½é£é™©/ä¿å‘½è¡Œä¸º", "3": "æ¢ç´¢/æ²Ÿé€š/ä¸­æ€§è¡Œä¸º" }, "type": { "rarity_type": "N/R/SR/SSR", "item_type": "Consumable/Treasure/Material/None", "attribute_type": "CP/XP/M", "Enemy": "NAME/NULL" }, "is_battle": true/false } } ]'},e.getBattlePrompt=function(t){var e=t.playerPower,n=t.enemyPower,r=t.enemyName,a=t.enemyRarity,i=t.isVictory;t.winRate;return(i?"ç©å®¶æˆ˜åŠ›"+e+"ï¼Œæ•Œäºº"+n+"ï¼Œä½¿ç”¨çµå®nullï¼Œå¤©èµ‹nullï¼Œæ•Œäºº"+r+"ï¼Œæˆ˜æ–—æ–¹å¼å¹³é™è¿æˆ˜,æå†™recordæˆ˜æ–—è¿‡ç¨‹èƒœåˆ©å¹¶ç»™äºˆä¸€ä¸ª"+a+"å¥–åŠ±ã€‚":"ç©å®¶æˆ˜åŠ›"+e+"ï¼Œæ•Œäºº"+n+"ï¼Œä½¿ç”¨çµå®nullï¼Œå¤©èµ‹nullï¼Œæ•Œäºº"+r+"ï¼Œæˆ˜æ–—æ–¹å¼å¹³é™è¿æˆ˜,åœ¨recordä¸‹æå†™æˆ˜æ–—è¿‡ç¨‹å¤±è´¥é€ƒèµ°ã€‚")+' è¯·è¿”å›ç¬¦åˆä»¥ä¸‹ JSON æ ¼å¼çš„æ•°æ®ï¼š\n[\n  {\n    "meta": { "location": "å½“å‰ä½ç½®" },\n    "narrative": { "record": "æˆ˜æ–—æè¿°" },\n    "interaction": {\n      "options": { "1": "è¿›å–/è´ªå©ª", "2": "ç¨³å¥/ä¿®æ•´", "3": "è¯¡å˜/å› æœ" },\n      "type": { "rarity_type": "'+a+'", "item_type": "Treasure", "attribute_type": "CP", "Enemy": "NULL" },\n      "is_battle": false\n    }\n  }\n]'},e.getDungeonUserPrompt=function(t){return"å·²é€‰æ‹©"+t.userChoice+",ä¸‹æ¬¡äº‹ä»¶,ç³»ç»Ÿå·²å†³å®šï¼šrarity "+t.rarity+"ï¼Œitem "+t.item+",attribute "+t.attribute+", battle "+t.battle+"ã€‚è¯·åŸºäºè¿™äº›æ•°æ®ç”Ÿæˆå‰§æƒ…æè¿°ã€‚"},t}()).instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/Property%20Animation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,i,a,t,r,o,l,s,u,p;return{setters:[function(e){n=e.applyDecoratedDescriptor,i=e.inheritsLoose,a=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,l=e.Label,s=e.Node,u=e.Animation,p=e.Component}],execute:function(){var c,m,y,g,b,h,f,A,d,P,L,C,N,I,v,D,_,z,w,X,M,x,k,E,F,H,V,O,B;r._RF.push({},"514080Mq6FDNaQNKfcQ/X7F","Property%20Animation",void 0);var Q=o.ccclass,R=o.property;e("PropertyAnimation",(c=Q("PropertyAnimation"),m=R({type:l,displayName:"CP Label",group:{name:"CP å±æ€§",displayOrder:1}}),y=R({type:s,displayName:"CP å¢åŠ åŠ¨ç”»",group:{name:"CP å±æ€§"}}),g=R({type:s,displayName:"CP å‡å°‘åŠ¨ç”»",group:{name:"CP å±æ€§"}}),b=R({type:l,displayName:"XP Label",group:{name:"XP å±æ€§",displayOrder:2}}),h=R({type:s,displayName:"XP å¢åŠ åŠ¨ç”»",group:{name:"XP å±æ€§"}}),f=R({type:s,displayName:"XP å‡å°‘åŠ¨ç”»",group:{name:"XP å±æ€§"}}),A=R({type:l,displayName:"Money Label",group:{name:"Money å±æ€§",displayOrder:3}}),d=R({type:s,displayName:"Money å¢åŠ åŠ¨ç”»",group:{name:"Money å±æ€§"}}),P=R({type:s,displayName:"Money å‡å°‘åŠ¨ç”»",group:{name:"Money å±æ€§"}}),L=R({type:l,displayName:"Age Label",group:{name:"Age å±æ€§",displayOrder:4}}),C=R({type:s,displayName:"Age å¢åŠ åŠ¨ç”»",group:{name:"Age å±æ€§"}}),N=R({type:s,displayName:"Age å‡å°‘åŠ¨ç”»",group:{name:"Age å±æ€§"}}),I=R({type:Boolean,displayName:"è‡ªåŠ¨éšè—åŠ¨ç”»",tooltip:"åŠ¨ç”»æ’­æ”¾å®Œæˆåæ˜¯å¦è‡ªåŠ¨éšè—"}),c((_=n((D=function(e){function n(){for(var n,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n=e.call.apply(e,[this].concat(r))||this,a(n,"CPLabel",_,t(n)),a(n,"increaseAnimation",z,t(n)),a(n,"decreaseAnimation",w,t(n)),a(n,"XPLabel",X,t(n)),a(n,"xpIncreaseAnimation",M,t(n)),a(n,"xpDecreaseAnimation",x,t(n)),a(n,"moneyLabel",k,t(n)),a(n,"moneyIncreaseAnimation",E,t(n)),a(n,"moneyDecreaseAnimation",F,t(n)),a(n,"ageLabel",H,t(n)),a(n,"ageIncreaseAnimation",V,t(n)),a(n,"ageDecreaseAnimation",O,t(n)),a(n,"autoHideAnimation",B,t(n)),n._oldCP=0,n._oldXP=0,n._oldMoney=0,n._oldAge=0,n}i(n,e);var r=n.prototype;return r.start=function(){var e=this;this._oldCP=this.getLabelValue(this.CPLabel),this._oldXP=this.getLabelValue(this.XPLabel),this._oldMoney=this.getLabelValue(this.moneyLabel),this._oldAge=this.getLabelValue(this.ageLabel),[this.increaseAnimation,this.decreaseAnimation,this.xpIncreaseAnimation,this.xpDecreaseAnimation,this.moneyIncreaseAnimation,this.moneyDecreaseAnimation,this.ageIncreaseAnimation,this.ageDecreaseAnimation].forEach((function(n){return e.initAnimNode(n)}))},r.initAnimNode=function(e){if(e){e.active=!1;var n=e.getComponent(u);n&&this.autoHideAnimation&&n.on(u.EventType.FINISHED,(function(){e.active=!1}),this)}},r.getLabelValue=function(e){return e&&parseInt(e.string)||0},r.update=function(e){this.checkChange(this.CPLabel,"_oldCP",this.increaseAnimation,this.decreaseAnimation),this.checkChange(this.XPLabel,"_oldXP",this.xpIncreaseAnimation,this.xpDecreaseAnimation),this.checkChange(this.moneyLabel,"_oldMoney",this.moneyIncreaseAnimation,this.moneyDecreaseAnimation),this.checkChange(this.ageLabel,"_oldAge",this.ageIncreaseAnimation,this.ageDecreaseAnimation)},r.checkChange=function(e,n,i,a){if(e){var t=parseInt(e.string)||0,r=this[n];if(t!==r){var o=t-r;o>0?this.playEffect(i,"+"+o):o<0&&this.playEffect(a,""+o),this[n]=t}}},r.playEffect=function(e,n){if(e){var i=e.getComponent(l)||e.getComponentInChildren(l);i&&(i.string=n),e.active=!0;var a=e.getComponent(u);a&&a.play()}},n}(p)).prototype,"CPLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(D.prototype,"increaseAnimation",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=n(D.prototype,"decreaseAnimation",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=n(D.prototype,"XPLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(D.prototype,"xpIncreaseAnimation",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(D.prototype,"xpDecreaseAnimation",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=n(D.prototype,"moneyLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(D.prototype,"moneyIncreaseAnimation",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(D.prototype,"moneyDecreaseAnimation",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(D.prototype,"ageLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(D.prototype,"ageIncreaseAnimation",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(D.prototype,"ageDecreaseAnimation",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(D.prototype,"autoHideAnimation",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),v=D))||v));r._RF.pop()}}}));

System.register("chunks:///_virtual/ResponseParser.ts",["cc"],(function(r){var e;return{setters:[function(r){e=r.cclegacy}],execute:function(){e._RF.push({},"758a6f34/9Hp74kMnTNFFXW","ResponseParser",void 0);r("ResponseParser",function(){function r(){}return r.parseLLMResponse=function(r){if(!r||""===r.trim())throw new Error("AIå“åº”ä¸ºç©º");var e=r.trim();e.startsWith("```json")?e=e.replace(/^```json\s*/,"").replace(/\s*```$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```$/,""));var s=e.indexOf("["),t=e.lastIndexOf("]");-1!==s&&-1!==t&&t>s&&(e=e.substring(s,t+1));try{return JSON.parse(e)}catch(r){throw new Error("è§£æAIå“åº”å¤±è´¥: "+(r instanceof Error?r.message:String(r)))}},r}());e._RF.pop()}}}));

System.register("chunks:///_virtual/save.ts",["./rollupPluginModLoBabelHelpers.js","cc","./YearAPI.ts"],(function(t){var e,o,n,i,a,s,r,c,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.Button,c=t.Component},function(t){l=t.YearAPI}],execute:function(){var u,v,p,h,d;a._RF.push({},"0c690+Zb4tIdIkVdevepI9y","save",void 0);var f=s.ccclass,y=s.property;t("save",(u=f("save"),v=y(r),u((d=e((h=function(t){function e(){for(var e,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,n(e,"saveButton",d,i(e)),e}o(e,t);var a=e.prototype;return a.start=function(){this.saveButton&&this.saveButton.node.on("click",this.onSaveButtonClick,this)},a.update=function(t){},a.onSaveButtonClick=function(){console.log("Save button clicked"),this.saveChatHistory()},a.saveChatHistory=function(){var t=l.getInstance().getChatHistory();if(t&&t.length>0){var e=JSON.stringify(t,null,2);this.saveToFile(e,"save.1json"),console.log("Chat history saved successfully")}else console.log("No chat history to save")},a.saveToFile=function(t,e){var o=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(o),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},e}(c)).prototype,"saveButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=h))||p));a._RF.pop()}}}));

System.register("chunks:///_virtual/Scene.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"27940XID0BIqa7tbRfmHTPR","Scene",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/Summary.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LLMAPI.ts"],(function(n){var t,o,e,r,u,i,a,s,c;return{setters:[function(n){t=n.applyDecoratedDescriptor,o=n.inheritsLoose,e=n.initializerDefineProperty,r=n.assertThisInitialized},function(n){u=n.cclegacy,i=n._decorator,a=n.Button,s=n.Component},function(n){c=n.LLMAPI}],execute:function(){var l,m,y,p,f;u._RF.push({},"462dfib+JlD6L17IoLHgkzs","Summary",void 0);var d=i.ccclass,g=i.property;n("Summary",(l=d("Summary"),m=g(a),l((f=t((p=function(n){function t(){for(var t,o=arguments.length,u=new Array(o),i=0;i<o;i++)u[i]=arguments[i];return t=n.call.apply(n,[this].concat(u))||this,e(t,"summaryButton",f,r(t)),t}o(t,n);var u=t.prototype;return u.start=function(){this.summaryButton&&(this.summaryButton.node.on(a.EventType.CLICK,this.onSummaryButtonClick,this),console.log("âœ… Summarybuttonç‚¹å‡»äº‹ä»¶å·²ç»‘å®š"))},u.onSummaryButtonClick=function(){var n=c.getInstance();n.setHistoryType("dungeon");console.log("=== å‘é€æ€»ç»“è¯·æ±‚ ==="),n.streamRequest('1. ç‰©å“å±æ€§æ˜ å°„ï¼šConsumable (æ¶ˆè€—å“/ä¸¹è¯)ï¼šéœ€æ ‡æ³¨å“é˜¶ã€‚Treasure (æ³•å®/è£…å¤‡)ï¼šéœ€æ ‡æ³¨å“é˜¶ã€‚Material (ææ–™/å¤©æåœ°å®)ï¼šéœ€æ ‡æ³¨å“é˜¶ã€‚\n2. ä»»åŠ¡è¦æ±‚ï¼šè¯·åŸºäºå¯¹è¯è®°å½•ï¼Œä¸¥æ ¼æ‰§è¡Œç´¯åŠ é€»è¾‘ï¼Œå¹¶æŒ‰ä»¥ä¸‹ JSON æ ¼å¼æ±‡æ€»ã€‚æ— æ”¶è·é¡¹å¡«nullã€‚\nJSON {\n    "Summary": {\n        "record": "ç»“æŸæ€»ç»“è¯",\n        "Consumable": "å“é˜¶(åç§°), ...",\n        "Treasure": "å“é˜¶(åç§°), ...",\n        "Material": "å“é˜¶(åç§°), ..."\n    }\n',void 0,void 0,(function(n){console.log("=== æ€»ç»“ç»“æœ ==="),console.log(n)}),(function(n){console.error("âŒ æ€»ç»“è¯·æ±‚å¤±è´¥:",n)}))},u.update=function(n){},t}(s)).prototype,"summaryButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=p))||y));u._RF.pop()}}}));

System.register("chunks:///_virtual/test.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,i,r,l,u,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,u=t.Button,s=t.Component}],execute:function(){var a,c,p,b,y,f,h,v,d;r._RF.push({},"a82be/7jcFLp4eKMIesw+OW","test",void 0);var g=l.ccclass,C=l.property;t("Test",(a=g("Test"),c=C(u),p=C(u),b=C(u),a((h=e((f=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,o(e,"button1",h,i(e)),o(e,"button2",v,i(e)),o(e,"button3",d,i(e)),e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.button1.node.on(u.EventType.CLICK,this.sayHello,this),this.button2.node.on(u.EventType.CLICK,this.sayHello,this),this.button3.node.on(u.EventType.CLICK,this.sayHello,this)},r.sayHello=function(){console.log("ä½ å¥½")},e}(s)).prototype,"button1",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(f.prototype,"button2",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=e(f.prototype,"button3",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=f))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/window.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,i,o,s,r,l,c,u,p;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized,s=n.createClass},function(n){r=n.cclegacy,l=n._decorator,c=n.Button,u=n.Node,p=n.Component}],execute:function(){var h,a,f,C,w,d,v,y,B;r._RF.push({},"8c070B+MKxP/olzqfCcnZef","window",void 0);var O=l.ccclass,_=l.property;n("GenericWindow",(h=O("GenericWindow"),a=_(c),f=_(c),C=_(u),h((v=t((d=function(n){function t(){for(var t,e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return t=n.call.apply(n,[this].concat(s))||this,i(t,"openButton",v,o(t)),i(t,"closeButton",y,o(t)),i(t,"windowContent",B,o(t)),t.onOpen=void 0,t.onClose=void 0,t._isOpen=!1,t}e(t,n);var r=t.prototype;return r.start=function(){this.windowContent&&(this.windowContent.active=!1),this.setupEventListeners()},r.onDestroy=function(){this.removeEventListeners()},r.open=function(){var n;!this._isOpen&&this.windowContent&&(this._isOpen=!0,this.windowContent.active=!0,null==(n=this.onOpen)||n.call(this))},r.close=function(){var n;this._isOpen&&this.windowContent&&(this._isOpen=!1,this.windowContent.active=!1,null==(n=this.onClose)||n.call(this))},r.toggle=function(){this._isOpen?this.close():this.open()},r.setupEventListeners=function(){this.openButton&&this.openButton.node.on(c.EventType.CLICK,this.onOpenClick,this),this.closeButton&&this.closeButton.node.on(c.EventType.CLICK,this.onCloseClick,this)},r.removeEventListeners=function(){this.openButton&&this.openButton.node.off(c.EventType.CLICK,this.onOpenClick,this),this.closeButton&&this.closeButton.node.off(c.EventType.CLICK,this.onCloseClick,this)},r.onOpenClick=function(){this.open()},r.onCloseClick=function(){this.close()},s(t,[{key:"isOpen",get:function(){return this._isOpen}}]),t}(p)).prototype,"openButton",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(d.prototype,"closeButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(d.prototype,"windowContent",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=d))||w));r._RF.pop()}}}));

System.register("chunks:///_virtual/YearAPI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LLMAPI.ts"],(function(e){var r,t,o,n;return{setters:[function(e){r=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){o=e.cclegacy},function(e){n=e.LLMAPI}],execute:function(){o._RF.push({},"42e0eRAz7pAYIrWmlBVDd96","YearAPI",void 0),e("YearAPI",function(){function e(){this.dataComponent=null,this.currentYear=1,this.llmAPI=null,this.llmAPI=n.getInstance(),this.llmAPI.setHistoryType("year")}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var o=e.prototype;return o.getChatHistory=function(){return this.llmAPI.getChatHistory()},o.setDataComponent=function(e){this.dataComponent=e},o.generateRarity=function(){var e,r=100*Math.random();e=r<60?"N":r<90?"R":r<99?"SR":"SSR";var t,o,n=100*Math.random();switch(t=n<.1?"AGE":n<33.4?"XP":n<66.7?"CP":"M",e){case"N":o=[-10,50];break;case"R":o=[-100,300];break;case"SR":o=[-500,1500];break;case"SSR":o=[-3e3,8e3];break;default:o=[-10,50]}return{rarity:e,type:t,value:Math.floor(Math.random()*(o[1]-o[0]+1))+o[0]}},o.requestNextYear=function(e){var o=this;return new Promise(r(t().mark((function r(a,s){var c,l,i,u,y,p,v;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,c=o.generateRarity(),l=c.rarity,i=c.type,u=c.value,y={year:o.currentYear,rarity:l,type:i,value:u},'Role:ä½ æ˜¯ä¿®ä»™ä¸–ç•Œçš„å¤©é“æ¼”åŒ–é€»è¾‘å¼•æ“ã€‚ä½ è´Ÿè´£å°†éšæœºæ¦‚ç‡è½¬åŒ–ä¸ºå……æ»¡ä»£å…¥æ„Ÿçš„ä¿®ä»™å‰§æƒ…ï¼Œå¹¶ä¸¥æ ¼ç»´æŠ¤åº•å±‚çš„æ•°å€¼é€»è¾‘ã€‚ [JSON Format]: ä½ å¿…é¡»ä¸¥æ ¼è¿”å›ä»¥ä¸‹JSONæ ¼å¼ï¼Œç»å¯¹ä¸èƒ½ä¿®æ”¹æ ¼å¼ç»“æ„ï¼š{"event": {"year": 1, "rarity": "R", "desc": "ç¬¬ N å¹´ï¼Œ...", "type": "XP", "value": æ•°å­—, "record": ""}} [Critical]: ä¸¥ç¦åœ¨JSONå¤–æ·»åŠ ä»»ä½•æ–‡å­—ã€è¯´æ˜æˆ–è§£é‡Šï¼Œåªèƒ½è¿”å›çº¯JSONï¼ [Narrative Strategy]: å‰§æƒ…æè¿° desc å¿…é¡»ä»¥ "ç¬¬ N å¹´" ä¸ºå‰ç¼€ï¼Œä¸”ä¸¥ç¦ç›´æ¥å‡ºç°ç³»ç»ŸåŒ–æ•°å€¼ï¼ˆå¦‚ "è·å¾— 100 ç»éªŒ"ã€"æˆ˜åŠ›æå‡ 50"ï¼‰ã€‚å¿…é¡»é€šè¿‡æ–‡å­¦åŒ–æå†™ä¼ è¾¾ã€‚ [Rarity System]: ç¨€æœ‰åº¦å·²ç”±ç³»ç»Ÿå†³å®šï¼Œä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§æä¾›çš„rarityå€¼ç”Ÿæˆå¯¹åº”é•¿åº¦çš„å‰§æƒ…æè¿°ã€‚N (Normal): çº¦ 30 å­—ï¼Œv âˆˆ [-10, 50] R (Rare): çº¦ 60 å­—ï¼Œv âˆˆ [-100,300] SR (Super Rare): çº¦ 100 å­—ï¼Œvâˆˆ [-500, 1500] SSR (Super Super Rare): çº¦ 150 å­—ï¼Œvâˆˆ [-3000, 8000] Type: "XP"(ç»éªŒ) "CP"(æˆ˜åŠ›) "M"(çµçŸ³) "AGE"(å¯¿å‘½)ã€‚Record: ä»…åœ¨ rarity=SSR æ—¶ç”Ÿæˆå½±å“æ€»ç»“ï¼Œå…¶ä»–æƒ…å†µä¸º ""ã€‚',p="ä¸‹ä¸€å¹´ã€‚ç³»ç»Ÿå·²å†³å®šï¼šå¹´ä»½"+y.year+"ï¼Œç¨€æœ‰åº¦"+y.rarity+"ï¼Œç±»å‹"+y.type+"ï¼Œæ•°å€¼"+y.value+"ã€‚è¯·åŸºäºè¿™äº›æ•°æ®ç”Ÿæˆä¿®ä»™å‰§æƒ…æè¿°ã€‚",(v=n.getInstance()).setHistoryType("year"),r.next=9,v.streamRequest(p,'Role:ä½ æ˜¯ä¿®ä»™ä¸–ç•Œçš„å¤©é“æ¼”åŒ–é€»è¾‘å¼•æ“ã€‚ä½ è´Ÿè´£å°†éšæœºæ¦‚ç‡è½¬åŒ–ä¸ºå……æ»¡ä»£å…¥æ„Ÿçš„ä¿®ä»™å‰§æƒ…ï¼Œå¹¶ä¸¥æ ¼ç»´æŠ¤åº•å±‚çš„æ•°å€¼é€»è¾‘ã€‚ [JSON Format]: ä½ å¿…é¡»ä¸¥æ ¼è¿”å›ä»¥ä¸‹JSONæ ¼å¼ï¼Œç»å¯¹ä¸èƒ½ä¿®æ”¹æ ¼å¼ç»“æ„ï¼š{"event": {"year": 1, "rarity": "R", "desc": "ç¬¬ N å¹´ï¼Œ...", "type": "XP", "value": æ•°å­—, "record": ""}} [Critical]: ä¸¥ç¦åœ¨JSONå¤–æ·»åŠ ä»»ä½•æ–‡å­—ã€è¯´æ˜æˆ–è§£é‡Šï¼Œåªèƒ½è¿”å›çº¯JSONï¼ [Narrative Strategy]: å‰§æƒ…æè¿° desc å¿…é¡»ä»¥ "ç¬¬ N å¹´" ä¸ºå‰ç¼€ï¼Œä¸”ä¸¥ç¦ç›´æ¥å‡ºç°ç³»ç»ŸåŒ–æ•°å€¼ï¼ˆå¦‚ "è·å¾— 100 ç»éªŒ"ã€"æˆ˜åŠ›æå‡ 50"ï¼‰ã€‚å¿…é¡»é€šè¿‡æ–‡å­¦åŒ–æå†™ä¼ è¾¾ã€‚ [Rarity System]: ç¨€æœ‰åº¦å·²ç”±ç³»ç»Ÿå†³å®šï¼Œä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§æä¾›çš„rarityå€¼ç”Ÿæˆå¯¹åº”é•¿åº¦çš„å‰§æƒ…æè¿°ã€‚N (Normal): çº¦ 30 å­—ï¼Œv âˆˆ [-10, 50] R (Rare): çº¦ 60 å­—ï¼Œv âˆˆ [-100,300] SR (Super Rare): çº¦ 100 å­—ï¼Œvâˆˆ [-500, 1500] SSR (Super Super Rare): çº¦ 150 å­—ï¼Œvâˆˆ [-3000, 8000] Type: "XP"(ç»éªŒ) "CP"(æˆ˜åŠ›) "M"(çµçŸ³) "AGE"(å¯¿å‘½)ã€‚Record: ä»…åœ¨ rarity=SSR æ—¶ç”Ÿæˆå½±å“æ€»ç»“ï¼Œå…¶ä»–æƒ…å†µä¸º ""ã€‚',e,(function(e){try{if(console.log("=== AI å“åº”è°ƒè¯•ä¿¡æ¯ ==="),console.log("åŸå§‹å“åº”å†…å®¹:",e),console.log("å“åº”ç±»å‹:",typeof e),console.log("å“åº”é•¿åº¦:",e?e.length:0),!e||""===e.trim())return console.error("âŒ AIå“åº”ä¸ºç©º"),void s(new Error("AIå“åº”ä¸ºç©º"));var r=e.trim();r.startsWith("```json")?r=r.replace(/^```json\s*/,"").replace(/\s*```$/,""):r.startsWith("```")&&(r=r.replace(/^```\s*/,"").replace(/\s*```$/,""));var t=r.indexOf("{"),n=r.lastIndexOf("}");-1!==t&&-1!==n&&n>t&&(r=r.substring(t,n+1)),console.log("æ¸…ç†åçš„å“åº”:",r);var c=JSON.parse(r);o.processAIResponse(c,y),a()}catch(r){console.error("è§£æAIå“åº”å¤±è´¥:",r),console.error("åŸå§‹å“åº”:",e),console.error("é”™è¯¯è¯¦æƒ…:",r.message),s(new Error("è§£æAIå“åº”å¤±è´¥: "+r.message))}}),(function(e){console.error("LLMè¯·æ±‚å¤±è´¥:",e),s(e)}));case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),s(r.t0);case 14:case"end":return r.stop()}}),r,null,[[0,11]])}))))},o.processAIResponse=function(e,r){if(console.log("=== AI å“åº”è°ƒè¯•ä¿¡æ¯ ==="),console.log("åŸå§‹ AI å“åº”:",e),console.log("ä»£ç ç”Ÿæˆçš„å¹´ä»½ä¿¡æ¯:",r),console.log("å“åº”ç±»å‹:",typeof e),console.log("dataComponent çŠ¶æ€:",this.dataComponent),this.dataComponent){if(e.event){var t=e.event;console.log("äº‹ä»¶å¯¹è±¡:",t),console.log("AIæè¿°:",t.desc);var o={event:{type:r.type,value:r.value,record:t.record||"",year:r.year,rarity:r.rarity,desc:t.desc}};console.log("å‡†å¤‡ä¼ é€’ç»™Dataç»„ä»¶çš„äº‹ä»¶æ•°æ®:",o),this.dataComponent.handleEvent(o),console.log("âœ… Dataç»„ä»¶å·²æ›´æ–°: "+o.event.type+" = "+o.event.value+" (ç¨€æœ‰åº¦: "+o.event.rarity+")"),this.currentYear++,o.event.record?console.log('âœ… Recordå­—æ®µå·²ä¼ é€’: "'+o.event.record+'"'):console.log("â„¹ï¸ æ— recordå­—æ®µæˆ–ä¸ºç©ºå­—ç¬¦ä¸²")}else console.error("âŒ AIå“åº”ä¸­ç¼ºå°‘ event å­—æ®µ"),console.log("aiResponse keys:",Object.keys(e));console.log("=== è°ƒè¯•ä¿¡æ¯ç»“æŸ ===")}else console.error("âŒ dataComponent ä¸ºç©ºï¼Œæ— æ³•æ›´æ–°æ•°æ®")},e}()).instance=null,o._RF.pop()}}}));

System.register("chunks:///_virtual/YearManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Display.ts","./YearAPI.ts","./NextButton.ts","./Data%20cener.ts"],(function(t){var e,n,o,a,r,l,i,s,u,c,p,h,d,C,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,i=t.Node,s=t.ScrollView,u=t.Button,c=t.instantiate,p=t.Component},function(t){h=t.Display},function(t){d=t.YearAPI},function(t){C=t.NextButton},function(t){g=t.Data}],execute:function(){var f,b,m,y,x,B,D,Y,v,L,N,P,w;r._RF.push({},"eb764Nx2m5D3bI6DyBmzJ51","YearManager",void 0);var I=l.ccclass,S=l.property;t("YearManager",(f=I("YearManager"),b=S(i),m=S(i),y=S(i),x=S(s),B=S(i),f((v=e((Y=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,o(e,"nextButton",v,a(e)),o(e,"contentContainer",L,a(e)),o(e,"yearPrefab",N,a(e)),o(e,"scrollView",P,a(e)),o(e,"dataCenterNode",w,a(e)),e.yearAPI=null,e.nextButtonController=null,e.currentYearDisplay=null,e.dataComponent=null,e}n(e,t);var r=e.prototype;return r.start=function(){var t,e,n;console.log("=== YearManager åˆå§‹åŒ– ==="),this.yearAPI=d.getInstance(),this.nextButtonController=null==(t=this.nextButton)?void 0:t.getComponent(C),console.log("dataCenterNode:",this.dataCenterNode),this.dataComponent=null==(e=this.dataCenterNode)?void 0:e.getComponent(g),console.log("è·å–åˆ°çš„Dataç»„ä»¶:",this.dataComponent),this.dataComponent?(this.yearAPI.setDataComponent(this.dataComponent),console.log("âœ… Dataç»„ä»¶å·²è¿æ¥åˆ°YearAPI"),console.log("Dataç»„ä»¶çš„Labelå¼•ç”¨çŠ¶æ€:"),console.log("  - xpLabel:",this.dataComponent.xpLabel),console.log("  - cpLabel:",this.dataComponent.cpLabel),console.log("  - mLabel:",this.dataComponent.mLabel),console.log("  - ageLabel:",this.dataComponent.ageLabel)):(console.error("âŒ æœªæ‰¾åˆ°Dataç»„ä»¶ï¼è¯·æ£€æŸ¥ï¼š"),console.error("  1. YearManagerçš„dataCenterNodeå±æ€§æ˜¯å¦å·²è®¾ç½®"),console.error("  2. dataCenterNodeæ˜¯å¦åŒ…å«Dataè„šæœ¬ç»„ä»¶")),null!=(n=this.nextButtonController)&&n.button?(this.nextButtonController.button.node.on(u.EventType.CLICK,this.onNextYear,this),console.log("âœ… æŒ‰é’®ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š")):console.error("âŒ æœªæ‰¾åˆ°Buttonç»„ä»¶"),console.log("=== YearManager åˆå§‹åŒ–å®Œæˆ ===")},r.onNextYear=function(){var t,e,n,o=this;null!=(t=this.nextButtonController)&&t.isLoadingState||(null==(e=this.nextButton)||e.emit("NextYearClicked"),null==(n=this.nextButtonController)||n.setLoadingState(!0),this.currentYearDisplay=this.createYearDisplay(),this.yearAPI.requestNextYear((function(t){var e;null==(e=o.currentYearDisplay)||e.appendContent(t),o.autoScrollToBottom()})).then((function(){var t;null==(t=o.nextButtonController)||t.setLoadingState(!1)})).catch((function(t){var e;console.error("è¯·æ±‚å¤±è´¥:",t),null==(e=o.nextButtonController)||e.setLoadingState(!1)})))},r.createYearDisplay=function(){var t=this;if(!this.contentContainer||!this.yearPrefab)return null;var e=c(this.yearPrefab);return e.name="Year_"+Date.now(),this.contentContainer.addChild(e),this.scheduleOnce((function(){t.autoScrollToBottom()}),.1),e.getComponent(h)},r.autoScrollToBottom=function(){this.scrollView&&this.scrollView.scrollToBottom(.1)},e}(p)).prototype,"nextButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(Y.prototype,"contentContainer",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(Y.prototype,"yearPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(Y.prototype,"scrollView",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(Y.prototype,"dataCenterNode",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=Y))||D));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});